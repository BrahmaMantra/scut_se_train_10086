# 定义agent名称
agent.sources = source1
agent.channels = channel1
agent.sinks = sink1_hdfs sink1_kafka

# 配置source
# 使用exec类型的source执行Java程序生成数据
agent.sources.source1.type = exec
agent.sources.source1.command = java -cp /root/generate_data-1.0-SNAPSHOT.jar core.GenerateData
agent.sources.source1.restart = true
agent.sources.source1.restartThrottle = 10000

# 配置channel - 增加容量参数
agent.channels.channel1.type = memory
agent.channels.channel1.capacity = 10000
agent.channels.channel1.transactionCapacity = 1000

# 配置HDFS sink
agent.sinks.sink1_hdfs.type = hdfs
agent.sinks.sink1_hdfs.hdfs.path = hdfs://bigdata01:9000/xdr/%Y%m%d
agent.sinks.sink1_hdfs.hdfs.filePrefix = xdr_
agent.sinks.sink1_hdfs.hdfs.fileType = DataStream
agent.sinks.sink1_hdfs.hdfs.writeFormat = Text
agent.sinks.sink1_hdfs.hdfs.batchSize = 500
agent.sinks.sink1_hdfs.hdfs.rollInterval = 30
agent.sinks.sink1_hdfs.hdfs.rollSize = 0
agent.sinks.sink1_hdfs.hdfs.rollCount = 0
agent.sinks.sink1_hdfs.hdfs.useLocalTimeStamp = true
agent.sinks.sink1_hdfs.hdfs.callTimeout = 60000

# 配置Kafka sink
agent.sinks.sink1_kafka.type = org.apache.flume.sink.kafka.KafkaSink
agent.sinks.sink1_kafka.brokerList = bigdata01:9092
agent.sinks.sink1_kafka.topic = xdr
agent.sinks.sink1_kafka.batchSize = 50
agent.sinks.sink1_kafka.requiredAcks = 1

# 将source、channel和sink绑定在一起
agent.sources.source1.channels = channel1
agent.sinks.sink1_hdfs.channel = channel1
agent.sinks.sink1_kafka.channel = channel1
